<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Convertidor</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
  <h2>Convertidor de archivos</h2>

  <h3>JJ a Excel</h3>
  <input type="file" id="fileInputJJ" accept=".txt">
  <button onclick="procesarArchivoJJ()">Convertir</button>

  <h3>JP a Excel</h3>
  <input type="file" id="fileInputJP" accept=".txt">
  <button onclick="procesarArchivoJP()">Convertir</button>

  <h3>AT a Excel</h3>
  <input type="file" id="fileInputAT" accept=".txt">
  <button onclick="procesarArchivoAT()">Convertir</button>

  <h3>EF a Excel</h3>
  <input type="file" id="fileInputEF" accept=".txt">
  <button onclick="procesarArchivoEF()">Convertir</button>

  <h3>TXT Tabulado a Excel</h3>
  <input type="file" id="fileInputTab" accept=".txt">
  <button onclick="procesarArchivoTabulado()">Convertir</button>

  <h3>Excel a TXT Tabulado</h3>
  <input type="file" id="fileInputExcel" accept=".xlsx">
  <button onclick="convertirExcelATxt()">Convertir</button>
  
  <script>
    // --- CONFIGURACIÓN JJ ---
    const columnasJJ = [
      [0, 5], [5, 23], [23, 173], [173, 174], [174, 182], [182, 186],
      [186, 197], [197, 208], [208, 228], [228, 248], [248, 258], [258, 259],
      [259, 271], [271, 277], [277, 278], [278, 279], [279, 280], [280, 281],
      [281, 282], [282, 283], [283, 284], [284, 285], [285, 287], [287, 289],
      [289, 291], [291, 293], [293, 295], [295, 297], [297, 303], [303, 304],
      [304, 312], [312, 324], [324, 330], [330, 331], [331, 332], [332, 340],
      [340, 352], [352, 358], [358, 359], [359, 361], [361, 369], [369, 381],
      [381, 387], [387, 388], [388, 390], [390, 398], [398, 410], [410, 416],
      [416, 417], [417, 418], [418, 436], [436, 440], [440, 441]
    ];

    const encabezadosJJ = [
      "Cart", "Nro_Expte", "Caratula", "Carácter_ART", "Fecha_Notif", "Dto_Judicial",
      "CUIT", "CUIL", "Nro_Siniestro", "Nro_Seclo", "Nro_Litigio", "Monto_Indet",
      "Monto_Reclamado", "Incap_Reclamada", "Estudios_Méd", "Certif_Méd", "Examen_Físico",
      "Vínculo_Laboral", "Actuación_ART", "Conting_1", "Conting_2", "Conting_3",
      "Enfermedad_1", "Enfermedad_2", "Enfermedad_3", "Objeto_1", "Objeto_2", "Objeto_3",
      "Incap_Perito", "Sentencia_1ra", "Fecha_Sent_1ra", "Monto_Sent_1ra", "Incap_1ra",
      "Ajuste_Baremo_1ra", "Sentencia_2da", "Fecha_Sent_2da", "Monto_Sent_2da", "Incap_2da",
      "Ajuste_Baremo_2da", "Sent_Corte_Prov", "Fecha_Sent_CP", "Monto_Sent_CP", "Incap_CP",
      "Ajuste_Baremo_CP", "Sent_Corte_Sup", "Fecha_Sent_CS", "Monto_Sent_CS", "Incap_CS",
      "Ajuste_Baremo_CS", "Denuncia_Penal", "Expte_Penal", "Dto_Judicial_2", "Tipo_Operacion"
    ];

    // --- CONFIGURACIÓN JP ---
    const columnasJP = [
      [0, 5], [5, 23], [23, 43], [43, 45], [45, 46], [46, 57],
      [57, 77], [77, 127], [127, 177], [177, 227], [227, 277], [277, 278]
    ];

    const encabezadosJP = [
      "Cart", "Nro_Expte", "Nro_Seclo", "ID_Profesional", "Tipo", "CUIT", "Matrícula",
      "Apellido", "Nombre", "Domicilio", "Estudio_Jurídico", "Tipo_Op"
    ];

    // --- CONFIGURACIÓN AT ---
    const columnasAT = [
      [1, 5], [6, 25], [26, 26], [27, 37], [38, 38], [39, 39], [40, 50], [51, 52], [53, 62], [63, 73],
      [74, 75], [76, 83], [84, 123], [124, 127], [128, 130], [131, 131], [132, 139], [140, 147], [148, 155],
      [156, 160], [161, 163], [164, 167], [168, 169], [170, 172], [173, 176], [177, 178], [179, 181],
      [182, 185], [186, 187], [188, 190], [191, 198], [199, 199], [200, 200], [201, 208], [209, 212],
      [213, 218], [219, 219], [220, 227], [228, 247], [248, 248], [249, 256], [257, 262], [263, 266],
      [267, 274], [275, 276], [277, 280], [281, 380], [381, 385], [386, 393], [394, 394], [395, 402],
      [403, 403], [404, 411], [412, 419], [420, 427], [428, 428], [429, 429], [430, 430], [431, 431],
      [432, 451], [452, 461], [462, 462], [463, 464], [465, 466], [467, 468], [469, 470], [471, 478],
      [479, 479], [480, 487], [488, 987]
    ];
    
    const encabezadosAT = [
      "ART", "Siniestro", "Op", "CUIT", "TS", "Oc. VP", "CUIT ocurrencia", "Categoria",
      "Cod Establecimiento", "CUIL trabajador", "Tipo DNI", "DNI", "APELLIDO Y NOMBRE",
      "PUESTO", "ANTIGÜEDAD", "SEXO", "F NACIMIENTO", "F OCURRENCIA", "F INASISTENCIA LAB",
      "AG MAT", "FORMA ACC", "DIAG 1", "LESION 1", "ZONA 1", "DIAG 2", "LESION 2", "ZONA 2",
      "DIAG 3", "LESION 3", "ZONA 3", "F CESE ILT", "IP", "MOTIVO CESE", "F IP", "TIPO IP",
      "% IP", "GI", "F DCM", "EXP DCM", "PAT", "F ALTA", "ROAM", "AÑO ROAM", "F CONOC",
      "COD PROV", "COD LOC", "CALLE", "ALTURA", "CPA", "ESTRÉS", "F RECHAZO", "MOTIVO",
      "F INICIO TRANSITORIEDAD", "F CESE T", "F ESTIMADA ALTA", "MOTIVO CESE T", "CRONICO",
      "RECA", "INTERCURRENCIA", "STRO INTER", "IB", "TTO PEND", "ESP 1", "ESP 2", "ESP 3",
      "FORMA DEN", "F MORTAL", "T PREST", "PRESTADOR", "RELATO"
    ];
    
    // --- CONFIGURACIÓN EF ---
    const columnasEF = [
      [1, 5], [6, 25], [26, 26], [27, 37], [38, 38], [39, 49], [50, 51], [52, 61], [62, 72], [73, 74],
      [75, 82], [83, 122], [123, 126], [127, 129], [130, 130], [131, 138], [139, 146], [147, 151],
      [152, 156], [157, 159], [160, 160], [161, 168], [169, 172], [173, 180], [181, 181], [182, 184],
      [185, 188], [189, 196], [197, 199], [200, 203], [204, 211], [212, 214], [215, 222], [223, 223],
      [224, 224], [225, 232], [233, 236], [237, 242], [243, 243], [244, 251], [252, 271], [272, 279],
      [280, 287], [288, 289], [290, 293], [294, 393], [394, 398], [399, 406], [407, 414], [415, 415],
      [416, 423], [424, 431], [432, 439], [440, 440], [441, 441], [442, 442], [443, 452],
      [453, 453], [454, 455], [456, 457], [458, 459]
    ];
    
    const encabezadosEF = [
      "ART", "Siniestro", "Op", "CUIT", "T Reg", "CUIT ocurrencia", "Categoria",
      "Cod Establecimiento", "CUIL trabajador", "Tipo DNI", "DNI", "APELLIDO Y NOMBRE",
      "PUESTO", "ANTIGÜEDAD", "SEXO", "F NACIMIENTO", "F INASISTENCIA LAB", "AG MAT",
      "AG CAU", "TIEMPO EXPO", "EX PER", "F EX", "DIAG 1", "F DIAG 1", "COD EX",
      "ZONA 1", "DIAG 2", "F DIAG 2", "ZONA 2", "DIAG 3", "F DIAG 3", "ZONA 3",
      "F CESE ILT", "IP", "MOTIVO CESE", "F IP", "TIPO IP", "% IP", "GI", "F DCM",
      "EXP DCM", "F ALTA", "F CONOC", "COD PROV", "COD LOC", "CALLE", "ALTURA", "CPA",
      "F RECHAZO", "MOTIVO", "F INICIO TRANSITORIEDAD", "F CESE T", "F ESTIMADA ALTA",
      "MOTIVO CESE T", "CRONICO", "RECA", "IB", "TTO PEND", "ESP 1", "ESP 2", "ESP 3"
    ];
        
    // --- ENCABEZADO JYM ---
    const encabezadosTab = [
      "Cod", "RAJ", "Fecha Registro", "Tipo Registro", "Libro", "J o M",
      "Ramo (Op)", "Sub Ramo (Op)", "Tipo Daño (Op)", "Expte (Op)", "Fuero (Op)",
      "Juzgado (Op)", "Nro Juzgado (Op)", "Secretaria (Op)", "Actor", "Demandado",
      "Asunto", "CUIL", "Abogado ART (Op)", "CUIL (Op)", "Estudio ART (Op)", "CUIL (Op)",
      "Abogado PA", "Póliza", "Endoso", "Certificado", "Póliza (Op)", "Siniestro",
      "Fecha siniestro (Op)", "Fecha demanda", "Fecha monto", "Monto indet",
      "Monte demanda", "Moneda", "Tipo ART (Op)", "No seguro", "Fecha AO (Op)",
      "Fecha fin juicio (Op)", "Estado Procesal", "Pagos de cap e int",
      "Honorarios y gastos", "Total monto reservado",
      "Monto reservado bruto de reaseguro", "Monto diferencia reserva comparada",
      "Monto reservado no siniestros", "RAJ mediación", "Carácter ART", "Observaciones"
    ];

    function procesarArchivoJJ() {
      const input = document.getElementById('fileInputJJ');
      const archivo = input.files[0];
      if (!archivo) return alert("Seleccioná un archivo .txt primero");

      const lector = new FileReader();
      lector.onload = function(e) {
        let contenido = e.target.result.replace(/\r?\n/g, '');
        const datos = [encabezadosJJ];

        const totalRegistros = Math.floor(contenido.length / 441);
        for (let i = 0; i < totalRegistros; i++) {
          const inicio = i * 441;
          const bloque = contenido.slice(inicio, inicio + 441);
          const fila = columnasJJ.map(([start, end]) => bloque.slice(start, end).trim());
          datos.push(fila);
        }

        descargarExcel(datos, "Datos_JJ", "datos_JJ.xlsx");
      };
      lector.readAsText(archivo, 'UTF-8');
    }

    function procesarArchivoJP() {
      const input = document.getElementById('fileInputJP');
      const archivo = input.files[0];
      if (!archivo) return alert("Seleccioná un archivo .txt primero");

      const lector = new FileReader();
      lector.onload = function(e) {
        let contenido = e.target.result.replace(/\r?\n/g, '');
        const datos = [encabezadosJP];

        const totalRegistros = Math.floor(contenido.length / 278);
        for (let i = 0; i < totalRegistros; i++) {
          const inicio = i * 278;
          const bloque = contenido.slice(inicio, inicio + 278);
          if (/^\s*$/.test(bloque)) continue;
          const fila = columnasJP.map(([start, end]) => bloque.slice(start, end).trim());
          datos.push(fila);
        }

        descargarExcel(datos, "Datos_JP", "datos_JP.xlsx");
      };
      lector.readAsText(archivo, 'UTF-8');
    }

    function procesarArchivoAT() {
      const input = document.getElementById('fileInputAT');
      const archivo = input.files[0];
      if (!archivo) return alert("Seleccioná un archivo .txt para AT");
    
      const lector = new FileReader();
      lector.onload = function(e) {
        let contenido = e.target.result.replace(/\r?\n/g, '');
        const datos = [encabezadosAT];
    
        const largoRegistro = 988;
        const totalRegistros = Math.floor(contenido.length / largoRegistro);
        for (let i = 0; i < totalRegistros; i++) {
          const inicio = i * largoRegistro;
          const bloque = contenido.slice(inicio, inicio + largoRegistro);
          if (/^\s*$/.test(bloque)) continue;
          const fila = columnasAT.map(([start, end]) => bloque.slice(start, end).trim());
          datos.push(fila);
        }
    
        descargarExcel(datos, "Datos_AT", "datos_AT.xlsx");
      };
      lector.readAsText(archivo, 'UTF-8');
    }
    
    function procesarArchivoEF() {
      const input = document.getElementById('fileInputEF');
      const archivo = input.files[0];
      if (!archivo) return alert("Seleccioná un archivo .txt para EF");
    
      const lector = new FileReader();
      lector.onload = function(e) {
        let contenido = e.target.result.replace(/\r?\n/g, '');
        const datos = [encabezadosEF];
    
        const largoRegistro = 460;
        const totalRegistros = Math.floor(contenido.length / largoRegistro);
        for (let i = 0; i < totalRegistros; i++) {
          const inicio = i * largoRegistro;
          const bloque = contenido.slice(inicio, inicio + largoRegistro);
          if (/^\s*$/.test(bloque)) continue;
          const fila = columnasEF.map(([start, end]) => bloque.slice(start, end).trim());
          datos.push(fila);
        }
    
        descargarExcel(datos, "Datos_EF", "datos_EF.xlsx");
      };
      lector.readAsText(archivo, 'UTF-8');
    }

    function procesarArchivoTabulado() {
      const input = document.getElementById('fileInputTab');
      const archivo = input.files[0];
      if (!archivo) return alert("Seleccioná un archivo .txt tabulado primero");

      const lector = new FileReader();
      lector.onload = function(e) {
        const contenido = e.target.result;
        const lineas = contenido.split(/\r?\n/).filter(linea => linea.trim() !== "");
        const datos = [encabezadosTab];

        for (const linea of lineas) {
          const fila = linea.split('\t').map(campo => campo.trim());
          datos.push(fila);
        }

        descargarExcel(datos, "Datos_Tabulados", "datos_tabulados.xlsx");
      };
      lector.readAsText(archivo, 'UTF-8');
    }

    function convertirExcelATxt() {
      const input = document.getElementById('fileInputExcel');
      const archivo = input.files[0];
      if (!archivo) return alert("Seleccioná un archivo .xlsx primero");

      const lector = new FileReader();
      lector.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const primeraHoja = workbook.SheetNames[0];
        const hoja = workbook.Sheets[primeraHoja];
        const datos = XLSX.utils.sheet_to_json(hoja, { header: 1 });

        const lineasTxt = datos
          .filter(fila => fila.some(celda => celda !== undefined && celda !== null && celda.toString().trim() !== ''))
          .map(fila => fila.map(celda => (celda ?? "").toString().trim()).join('\t'))
          .join('\n');

        const blob = new Blob([lineasTxt], { type: "text/plain;charset=utf-8" });
        const enlace = document.createElement("a");
        enlace.href = URL.createObjectURL(blob);
        enlace.download = "convertido.txt";
        enlace.click();
      };
      lector.readAsArrayBuffer(archivo);
    }
    
    function descargarExcel(datos, nombreHoja, nombreArchivo) {
      const hoja = XLSX.utils.aoa_to_sheet(datos);
      const libro = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(libro, hoja, nombreHoja);
      XLSX.writeFile(libro, nombreArchivo);
    }
  </script>
</body>
</html>
